<!DOCTYPE html>
<html>
<head>
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<title>
Fixing Common Bundler Problems
</title>
<link href="../../../../assets/application-1b6070a43c3e8d37df5eb4ad2c23b344.css" media="all" rel="stylesheet" type="text/css" />
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2747647-1']);
  _gaq.push(['_setSiteSpeedSampleRate', 100]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>
<body class='container-fluid'>
<div class='full-width' id='wcc'>
<div id='header'>
<a href="../../../../index.html">whatcodecraves.com</a>
</div>

<div id='main'>
<div id="carbonads-container">
  <div class="carbonad">
    <div id="azcarbon"></div>
      <script type="text/javascript">
        var z = document.createElement("script");
        z.type = "text/javascript";
        z.async = true;
        z.src = "http://engine.carbonads.com/z/17311/azcarbon_2_1_0_VERT";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(z, s);
      </script>
    </div>
  </div>
<div class='post'>
<h1>Fixing Common Bundler Problems</h1>
<a href="http://news.ycombinator.com/submit" class="hn-share-button">Vote on HN</a>
<a href="https://twitter.com/share" class="twitter-share-button" data_via="whatcodecraves">Tweet</a>
<div class='g-plus' data-action='share' data-annontation='bubble'></div>
<p><img src="../../../../images/gembundler.png" style="float:left">
When <a href="http://gembundler.com/">bundler</a> first came out, I really wanted
to like it. It promised a clean way to declare dependencies on for
your application in a single place, and have that be definitive
regardless of what box your app was running on.  Unfortunately,
reality didn't match up with promises and I've had plenty of headaches
from bundler problems.  Read on for a list of tips I've pulled
together to save you some headache.</p><h2>Ensure you're local bundler is the same version as your server</h2><p>Different versions of bundler may act differently:</p><pre><code>bundle --version  # on your local machine and your server
sudo gem install bundler --version="0.9.26"
</code></pre><h2>Explicitly specify gem versions</h2><p>Did you know in HTTParty 0.4.5, there's no 'parsed_response' method on
a response object?  Well, neither did I when it worked fine on my
local laptop (0.6.1), but not on the server (0.4.5)</p><pre><code>gem "httparty"  # bad times if your system gem is out of date...
gem "httparty", "~&gt; 0.6.1"  # better, but...
gem "httparty", "0.6.1"     # ...why not just specify the version everyone should use?
</code></pre><h2>Check you're actually using gems installed by bundler</h2><p>Once in a while, bundler will report success on install, but you'll
get the wrong gems loaded in your load path.  Grep your load path to
double check libraries you're having trouble with</p><pre><code># in script/console
&gt;&gt; $:.grep /http/
=&gt; ["/Users/jch/.bundle/ruby/1.8/gems/httparty-0.6.1/lib"]
</code></pre><h2>Gemfile conditionals</h2><p>bundler allows you to specify groups so only gems you need in one
environment are loaded:</p><pre><code># we don't call the group :test because we don't want them auto-required
group :test do
  gem 'database_cleaner', '~&gt; 0.5.0'
  gem 'rspec'
  gem 'rspec-rails', '~&gt; 1.3.2', :require =&gt; 'spec/rails'
end
</code></pre><p>All gems you specify in your Gemfile WILL be installed regardless of
what RAILS_ENV you're currently on.  There's a very deceptively named
option called --without that does not work as you would expect:</p><pre><code># weird, but this will install gems in group test
bundle install --without=test
</code></pre><p>This can turn out to be a disaster if your production environment
tries to install a OSX specific gem with native extensions that you
use for development.  An ugly fix in the meantime is to add
conditionals that look for an environment variable:</p><pre><code>if ['test', 'cucumber'].include?(ENV['RAILS_ENV'])
  group :test do
    # your gems
  end
end
</code></pre><h2>Update your capistrano</h2><p>Don't forget to bundle when you deploy:</p><pre><code>after  "deploy:update_code", "deploy:bundle"
namespace :deploy do
  desc "Freeze dependencies"
  task :bundle, :roles =&gt; :app do
    run "cd #{release_path} &amp;&amp; bundle install --relock --without=test"
  end
end
</code></pre><h2>NameErrors and autoloading issues</h2><p>Read <a href="http://github.com/josevalim/inherited_resources/issues/issue/34">this
issue</a>.
The fix is to skip the require in your Gemfile and do the require in
your environment.rb:</p><pre><code># Gemfile
gem 'misbehaving_gem', :require_as =&gt; []

# environment.rb
Rails::Initializer.run do |config|
  # ...
  config.gem 'misbehaving_gem'
  # ...
end
</code></pre><h2>Nuke .bundler</h2><p>When all else doesn't make sense, and you've pulled out what precious
little hair you have left:</p><pre><code>rm -rf RAILS_ROOT/.bundle      # removes gems for this project
rm -rf ~/.bundle               # removes cached gems for your current user
rm -rf RAILS_ROOT/Gemfile.lock # lets you do a fresh 'bundle install'

# do a fresh bundle install
bundle install
</code></pre><h2>Other</h2><p>Bundler is still a moving target as far as bugs goes.  It's getting
better with each release, so many of these issues might not exist by
the time you start using it.  Meanwhile, hopefully this list above is
will save you some time with bundler related headaches.  Let me know
in the comments if you've encountered other tips for resolving these
problems.</p>
</div>
<script src="../../../../assets/post-6db30d9cd8415ddc540433d54a06699e.js" type="text/javascript"></script>
<script>
  //<![CDATA[
    hljs.initHighlightingOnLoad();
  //]]>
</script>
<script type='text/javascript'>
  // HackerNews
  (function(d, t) {
    var g = d.createElement(t),
        s = d.getElementsByTagName(t)[0];
    g.src = '//hnbutton.appspot.com/static/hn.js';
    s.parentNode.insertBefore(g, s);
  }(document, 'script'));

  // Twitter
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");

  // Google Plus
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname  = 'whatcodecraves';
  var disqus_title      = 'Fixing Common Bundler Problems';
  var disqus_identifier = '/articles/2010/08/12/fixing-common-bundler-problems';


  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div>
<div id='footer'>
<p>
Copyright Jerry Cheung 2007 - 2014 &nbsp;&nbsp;
<a href="https://github.com/jch/whatcoderaves.com">Source for this blog</a>
</p>
</div>
</div>
</body>
</html>

#!/bin/bash
#
# publish [-v] [-s] [-o] [actions]
#
# -v verbose
# -s source directory of markdown posts to publish. Defaults to `src`
# -o output directory of published html posts. Defaults to `posts`
#
# `actions` set which publish_* scripts to execute. Defaults to `posts index`
#
# Markdown documents modified more recently than the output directory are
# published. To force a publish, `touch src/file-to-publish.md`
#
set -e

# shared with other publish_* scripts
set -a
verbose=
src_dir='src'
output_dir='posts'

function log() {
  local message=$1

  [[ $verbose ]] && echo $message || true
}
set +a

while getopts ':vs:o:' flag; do
  case "$flag" in
    v) verbose=1 ;;
    s) src_dir="${OPTARG}" ;;
    o) output_dir="${OPTARG}" ;;
  esac
done
shift $(($OPTIND - 1))

log "src_dir: $src_dir"
log "output_dir: $output_dir"

[[ $# -gt 0 ]] && actions="$@" || actions='posts index'
for a in $actions; do
  # echo $a
  # log "publishing $a"
  publish_$a
done
